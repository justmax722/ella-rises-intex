<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Event - Ella Rises CRM</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-background min-h-screen flex">
    <!-- Sidebar Navigation -->
    <%- include('partials/sidebar', { user: user, currentPage: 'events' }) %>

    <!-- Main Content Area -->
    <main class="flex-1 p-6 overflow-auto">
        <div class="space-y-6">
            <!-- Page Header -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-serif font-bold text-primary">Edit Event Session</h1>
                    <p class="text-muted-foreground mt-1">Update event session details</p>
                </div>
                <a href="/events/<%= session.sessionid %>" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    Cancel
                </a>
            </div>

            <!-- Error Message -->
            <% if (typeof query !== 'undefined' && query.error) { %>
            <div class="p-4 bg-destructive/10 border border-destructive/20 rounded-lg flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-destructive flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-sm text-destructive font-medium">
                    <% if (query.error === 'missing_fields') { %>
                        Please fill in all required fields.
                    <% } else if (query.error === 'invalid_date') { %>
                        Invalid date format. Please check your dates.
                    <% } else if (query.error === 'start_after_end') { %>
                        Event start date/time must be before the end date/time.
                    <% } else if (query.error === 'deadline_after_end') { %>
                        Registration deadline cannot be after the event end date/time.
                    <% } else { %>
                        An error occurred. Please try again.
                    <% } %>
                </p>
            </div>
            <% } %>

            <!-- Success Message -->
            <% if (typeof query !== 'undefined' && query.success === 'true') { %>
            <div class="p-4 rounded-md shadow-sm" style="background-color: #80d8a1; border: 1px solid #7bdfa0;">
                <p class="text-sm font-medium text-white">Event updated successfully!</p>
            </div>
            <% } %>

            <!-- Edit Form -->
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                <div class="p-6">
                    <form action="/events/<%= session.sessionid %>/edit" method="POST" class="space-y-4">
                        <!-- Event Name (Read-only) -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">Event</label>
                            <input 
                                type="text" 
                                value="<%= session.eventname %>" 
                                disabled
                                class="flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                            <p class="text-xs text-muted-foreground">Event name cannot be changed</p>
                        </div>

                        <!-- Event DateTime Start -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventdatetimestart">Event Start Date & Time *</label>
                            <input 
                                type="datetime-local" 
                                id="eventdatetimestart" 
                                name="eventdatetimestart" 
                                required
                                value="<%= (() => {
                                    const startDate = new Date(session.eventdatetimestart);
                                    const year = startDate.getFullYear();
                                    const month = String(startDate.getMonth() + 1).padStart(2, '0');
                                    const day = String(startDate.getDate()).padStart(2, '0');
                                    const hours = String(startDate.getHours()).padStart(2, '0');
                                    const minutes = String(startDate.getMinutes()).padStart(2, '0');
                                    return `${year}-${month}-${day}T${hours}:${minutes}`;
                                })() %>"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                        </div>

                        <!-- Event DateTime End -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventdatetimeend">Event End Date & Time *</label>
                            <input 
                                type="datetime-local" 
                                id="eventdatetimeend" 
                                name="eventdatetimeend" 
                                required
                                value="<%= (() => {
                                    const endDate = new Date(session.eventdatetimeend);
                                    const year = endDate.getFullYear();
                                    const month = String(endDate.getMonth() + 1).padStart(2, '0');
                                    const day = String(endDate.getDate()).padStart(2, '0');
                                    const hours = String(endDate.getHours()).padStart(2, '0');
                                    const minutes = String(endDate.getMinutes()).padStart(2, '0');
                                    return `${year}-${month}-${day}T${hours}:${minutes}`;
                                })() %>"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                        </div>

                        <!-- Event Location -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventlocation">Event Location *</label>
                            <input 
                                type="text" 
                                id="eventlocation" 
                                name="eventlocation" 
                                required
                                value="<%= session.eventlocation || '' %>"
                                placeholder="Enter event location"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                        </div>

                        <!-- Event Capacity -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventcapacity">Event Capacity</label>
                            <input 
                                type="number" 
                                id="eventcapacity" 
                                name="eventcapacity" 
                                min="1"
                                value="<%= session.eventcapacity || '' %>"
                                placeholder="Leave empty to use event default capacity"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                            <p class="text-xs text-muted-foreground">Leave empty to use the event's default capacity (<%= session.eventdefaultcapacity || 'N/A' %>)</p>
                        </div>

                        <!-- Event Registration Deadline -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventregistrationdeadline">Registration Deadline</label>
                            <input 
                                type="datetime-local" 
                                id="eventregistrationdeadline" 
                                name="eventregistrationdeadline" 
                                value="<%= session.eventregistrationdeadline ? (() => {
                                    const regDate = new Date(session.eventregistrationdeadline);
                                    const year = regDate.getFullYear();
                                    const month = String(regDate.getMonth() + 1).padStart(2, '0');
                                    const day = String(regDate.getDate()).padStart(2, '0');
                                    const hours = String(regDate.getHours()).padStart(2, '0');
                                    const minutes = String(regDate.getMinutes()).padStart(2, '0');
                                    return `${year}-${month}-${day}T${hours}:${minutes}`;
                                })() : '' %>"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                            <p class="text-xs text-muted-foreground">Optional - leave empty if no deadline</p>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex gap-4 pt-4">
                            <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                                Save Changes
                            </button>
                            <a href="/events/<%= session.sessionid %>" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
</body>
</html>

<script>
    // Auto-hide success message
    const successMessage = document.querySelector('[style*="background-color: #80d8a1"]');
    if (successMessage) {
        setTimeout(() => {
            successMessage.style.transition = 'opacity 0.5s';
            successMessage.style.opacity = '0';
            setTimeout(() => {
                successMessage.remove();
            }, 500);
        }, 5000);
    }
</script>

