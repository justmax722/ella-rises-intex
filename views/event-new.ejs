<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Event Template - Ella Rises CRM</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-background min-h-screen flex">
    <!-- Sidebar Navigation -->
    <%- include('partials/sidebar', { user: user, currentPage: 'events' }) %>

    <!-- Main Content Area -->
    <main class="flex-1 p-6 overflow-auto">
        <div class="space-y-6 max-w-3xl">
            <!-- Page Header -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-serif font-bold text-primary">Create New Event</h1>
                    <p class="text-muted-foreground mt-1">Define a new event type that can be scheduled as sessions.</p>
                </div>
                <a href="<%= returnTo || '/events/create' %>" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    Cancel
                </a>
            </div>

            <!-- Error Message -->
            <% if (typeof query !== 'undefined' && query.error) { %>
            <div class="p-4 bg-destructive/10 border border-destructive/20 rounded-md">
                <p class="text-sm text-destructive">
                    <% if (query.error === 'missing_name') { %>
                        Please provide an event name.
                    <% } else if (query.error === 'missing_event_type') { %>
                        Please select an event type or create a new one.
                    <% } else { %>
                        An error occurred while creating the event. Please try again.
                    <% } %>
                </p>
            </div>
            <% } %>

            <!-- Create Event Template Form -->
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                <div class="p-6">
                    <form action="/events/new" method="POST" class="space-y-4">
                        <input type="hidden" name="returnTo" value="<%= returnTo || '/events/create' %>">

                        <!-- Event Type -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventtypeid">Event Type</label>
                            <select 
                                id="eventtypeid" 
                                name="eventtypeid" 
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            >
                                <option value="">Select an event type...</option>
                                <% if (typeof eventTypes !== 'undefined' && eventTypes.length > 0) { %>
                                    <% eventTypes.forEach(type => { %>
                                        <option value="<%= type.eventtypeid %>"><%= type.eventtype %></option>
                                    <% }); %>
                                <% } %>
                                <option value="__new_type">+ Create a New Event Type</option>
                            </select>
                        </div>

                        <!-- New Event Type Name (shown when __new_type selected) -->
                        <div id="newEventTypeContainer" class="space-y-2 hidden">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="neweventtype">New Event Type Name</label>
                            <input 
                                type="text" 
                                id="neweventtype" 
                                name="neweventtype" 
                                placeholder="e.g., Leadership, STEAM, Art"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                        </div>

                        <!-- Event Name -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventname">Event Name *</label>
                            <input 
                                type="text" 
                                id="eventname" 
                                name="eventname" 
                                required
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                        </div>

                        <!-- Event Description -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventdescription">Event Description</label>
                            <textarea
                                id="eventdescription"
                                name="eventdescription"
                                rows="4"
                                class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                            ></textarea>
                        </div>

                        <!-- Recurrence Pattern -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventrecurrencepattern">Recurrence Pattern</label>
                            <input type="hidden" id="eventrecurrencepattern" name="eventrecurrencepattern">
                            <div class="flex flex-wrap gap-2" id="recurrenceButtons">
                                <% const recurrenceOptions = ['Weekly', 'Monthly', 'Annual']; %>
                                <% recurrenceOptions.forEach(option => { %>
                                    <button type="button" data-value="<%= option %>" class="recurrence-btn inline-flex items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium text-muted-foreground hover:bg-muted">
                                        <%= option %>
                                    </button>
                                <% }); %>
                            </div>
                            <p class="text-xs text-muted-foreground">Select how often this event generally occurs.</p>
                        </div>

                        <!-- Default Capacity -->
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="eventdefaultcapacity">Default Capacity</label>
                            <input 
                                type="number" 
                                id="eventdefaultcapacity" 
                                name="eventdefaultcapacity" 
                                min="1"
                                placeholder="e.g., 100"
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                            />
                        </div>

                        <!-- Submit Button -->
                        <div class="flex gap-4 pt-4">
                            <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                                Create Event
                            </button>
                            <a href="<%= returnTo || '/events/create' %>" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Toggle new event type input
        const eventTypeSelect = document.getElementById('eventtypeid');
        const newEventTypeContainer = document.getElementById('newEventTypeContainer');

        if (eventTypeSelect && newEventTypeContainer) {
            eventTypeSelect.addEventListener('change', () => {
                if (eventTypeSelect.value === '__new_type') {
                    newEventTypeContainer.classList.remove('hidden');
                } else {
                    newEventTypeContainer.classList.add('hidden');
                }
            });
        }

        // Recurrence pattern buttons
        const recurrenceButtons = document.querySelectorAll('.recurrence-btn');
        const recurrenceInput = document.getElementById('eventrecurrencepattern');

        function setRecurrence(value, button) {
            recurrenceButtons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-primary-foreground', 'shadow');
                btn.classList.add('bg-background', 'text-muted-foreground');
            });
            button.classList.add('bg-primary', 'text-primary-foreground', 'shadow');
            button.classList.remove('bg-background', 'text-muted-foreground');
            recurrenceInput.value = value;
        }

        recurrenceButtons.forEach(btn => {
            btn.addEventListener('click', () => setRecurrence(btn.dataset.value, btn));
        });
    </script>
</body>
</html>


