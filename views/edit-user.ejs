<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit User - Ella Rises CRM</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-background min-h-screen flex">
    <!-- Sidebar Navigation -->
    <%- include('partials/sidebar', { user: user, currentPage: 'users' }) %>

    <!-- Main Content Area -->
    <main class="flex-1 p-6 md:p-8">
        <div class="max-w-4xl mx-auto">
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-3xl md:text-4xl font-serif text-foreground mb-2">Edit User</h1>
                <p class="text-base text-card-foreground/70">Update user information and permissions</p>
            </div>

            <!-- Success/Error Messages -->
            <% if (typeof query !== 'undefined' && query.success) { %>
            <div class="mb-6 p-4 bg-secondary/20 border border-secondary rounded-md">
                <p class="text-sm text-card-foreground text-center">
                    User updated successfully.
                </p>
            </div>
            <% } %>
            <% if (typeof query !== 'undefined' && query.error) { %>
            <div class="mb-6 p-4 bg-destructive/10 border border-destructive/20 rounded-md">
                <p class="text-sm text-destructive text-center">
                    <% if (query.error === 'missing_fields') { %>
                        Please fill in all required fields.
                    <% } else if (query.error === 'password_too_short') { %>
                        Password must be at least 6 characters long.
                    <% } else if (query.error === 'update_failed') { %>
                        Failed to update user. Please try again.
                    <% } else { %>
                        An error occurred. Please try again.
                    <% } %>
                </p>
            </div>
            <% } %>

            <!-- Edit User Form -->
            <div class="bg-card rounded-lg shadow-sm overflow-hidden">
                <div class="p-6 border-b border-border">
                    <h3 class="text-lg font-semibold text-card-foreground">User Information</h3>
                </div>
                <form method="POST" action="/users/update/<%= editUser.userid %>" class="p-6 space-y-6">
                    <!-- Email -->
                    <div>
                        <label for="useremail" class="block text-sm font-medium text-card-foreground mb-2">Email</label>
                        <input 
                            type="email" 
                            id="useremail" 
                            name="useremail" 
                            value="<%= editUser.email %>"
                            required
                            class="w-full px-4 py-2.5 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent transition-colors"
                        />
                    </div>

                    <!-- First Name -->
                    <div>
                        <label for="userfirstname" class="block text-sm font-medium text-card-foreground mb-2">First Name</label>
                        <input 
                            type="text" 
                            id="userfirstname" 
                            name="userfirstname" 
                            value="<%= editUser.firstName %>"
                            required
                            class="w-full px-4 py-2.5 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent transition-colors"
                        />
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label for="userlastname" class="block text-sm font-medium text-card-foreground mb-2">Last Name</label>
                        <input 
                            type="text" 
                            id="userlastname" 
                            name="userlastname" 
                            value="<%= editUser.lastName %>"
                            required
                            class="w-full px-4 py-2.5 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent transition-colors"
                        />
                    </div>

                    <!-- Role -->
                    <div>
                        <label for="roleid" class="block text-sm font-medium text-card-foreground mb-2">Role</label>
                        <select 
                            id="roleid" 
                            name="roleid" 
                            required
                            class="w-full px-4 py-2.5 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent transition-colors"
                        >
                            <option value="1" <%= editUser.roleid === 1 ? 'selected' : '' %>>Manager</option>
                            <option value="2" <%= editUser.roleid === 2 ? 'selected' : '' %>>User</option>
                            <option value="3" <%= editUser.roleid === 3 ? 'selected' : '' %>>Donor</option>
                        </select>
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input 
                                type="checkbox" 
                                name="accountactive" 
                                <%= editUser.accountactive ? 'checked' : '' %>
                                class="w-4 h-4 border border-input rounded focus:ring-2 focus:ring-ring"
                            />
                            <span class="text-sm font-medium text-card-foreground">Active Account</span>
                        </label>
                        <p class="text-xs text-muted-foreground mt-1">Uncheck to deactivate this user's account</p>
                    </div>

                    <!-- Password -->
                    <div>
                        <label for="password" class="block text-sm font-medium text-card-foreground mb-2">Password</label>
                        <div class="relative">
                            <input 
                                type="password" 
                                id="password" 
                                name="password" 
                                placeholder="Leave empty for no change"
                                class="w-full px-4 py-2.5 pr-10 border border-input rounded-md bg-background text-foreground placeholder:text-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent transition-colors"
                            />
                            <button 
                                type="button"
                                onclick="togglePasswordVisibility('password', 'passwordToggle')"
                                id="passwordToggle"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground focus:outline-none"
                                tabindex="-1"
                            >
                                <svg id="passwordToggleIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-muted-foreground mt-1">Leave empty for no change. If provided, password must be at least 6 characters long.</p>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex gap-3 justify-end pt-4 border-t border-border">
                        <a 
                            href="/users" 
                            class="px-4 py-2 border border-input rounded-md text-sm font-medium text-card-foreground hover:bg-muted transition-colors"
                        >
                            Cancel
                        </a>
                        <button 
                            type="submit" 
                            class="px-4 py-2 bg-primary text-primary-foreground rounded-md text-sm font-medium hover:bg-primary/90 transition-colors"
                        >
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Password visibility toggle function
        function togglePasswordVisibility(inputId, toggleId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(toggleId + 'Icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
            } else {
                input.type = 'password';
                icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
            }
        }
    </script>

</body>
</html>

